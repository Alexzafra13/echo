generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                 String          @id @default(uuid())
  username           String          @unique @db.VarChar(50)
  email              String?         @unique @db.VarChar(255)
  passwordHash       String          @map("password_hash") @db.VarChar(255)
  name               String?         @db.VarChar(100)
  isAdmin            Boolean         @default(false) @map("is_admin")
  isActive           Boolean         @default(true) @map("is_active")
  theme              String          @default("dark") @db.VarChar(20)
  language           String          @default("es") @db.VarChar(10)
  mustChangePassword Boolean         @default(true) @map("must_change_password")
  lastLoginAt        DateTime?       @map("last_login_at")
  lastAccessAt       DateTime?       @map("last_access_at")
  avatarPath         String?         @map("avatar_path") @db.VarChar(512)
  avatarMimeType     String?         @map("avatar_mime_type") @db.VarChar(50)
  avatarSize         BigInt?         @map("avatar_size")
  avatarUpdatedAt    DateTime?       @map("avatar_updated_at")
  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")
  bookmarks          Bookmark[]
  playHistory        PlayHistory[]
  playQueue          PlayQueue?
  players            Player[]
  playlists          Playlist[]
  radioStations      RadioStation[]
  shares             Share[]
  streamTokens       StreamToken[]
  playStats          UserPlayStats[]
  ratings            UserRating[]
  starred            UserStarred[]

  @@map("users")
}

model StreamToken {
  id         String    @id @default(uuid())
  userId     String    @map("user_id") @db.VarChar(36)
  token      String    @unique @db.VarChar(255)
  expiresAt  DateTime  @map("expires_at")
  createdAt  DateTime  @default(now()) @map("created_at")
  lastUsedAt DateTime? @map("last_used_at")
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@index([expiresAt])
  @@map("stream_tokens")
}

model Artist {
  id                          String              @id @default(uuid())
  name                        String              @db.VarChar(255)
  albumCount                  Int                 @default(0) @map("album_count")
  songCount                   Int                 @default(0) @map("song_count")
  mbzArtistId                 String?             @map("mbz_artist_id") @db.VarChar(36)
  mbidSearchedAt              DateTime?           @map("mbid_searched_at")
  biography                   String?
  biographySource             String?             @map("biography_source") @db.VarChar(50)
  profileImagePath            String?             @map("profile_image_path") @db.VarChar(512)
  profileImageUpdatedAt       DateTime?           @map("profile_image_updated_at")
  externalProfilePath         String?             @map("external_profile_path") @db.VarChar(512)
  externalProfileSource       String?             @map("external_profile_source") @db.VarChar(50)
  externalProfileUpdatedAt    DateTime?           @map("external_profile_updated_at")
  backgroundImagePath         String?             @map("background_image_path") @db.VarChar(512)
  backgroundUpdatedAt         DateTime?           @map("background_updated_at")
  backgroundPosition          String?             @map("background_position") @db.VarChar(50)
  externalBackgroundPath      String?             @map("external_background_path") @db.VarChar(512)
  externalBackgroundSource    String?             @map("external_background_source") @db.VarChar(50)
  externalBackgroundUpdatedAt DateTime?           @map("external_background_updated_at")
  bannerImagePath             String?             @map("banner_image_path") @db.VarChar(512)
  bannerUpdatedAt             DateTime?           @map("banner_updated_at")
  externalBannerPath          String?             @map("external_banner_path") @db.VarChar(512)
  externalBannerSource        String?             @map("external_banner_source") @db.VarChar(50)
  externalBannerUpdatedAt     DateTime?           @map("external_banner_updated_at")
  logoImagePath               String?             @map("logo_image_path") @db.VarChar(512)
  logoUpdatedAt               DateTime?           @map("logo_updated_at")
  externalLogoPath            String?             @map("external_logo_path") @db.VarChar(512)
  externalLogoSource          String?             @map("external_logo_source") @db.VarChar(50)
  externalLogoUpdatedAt       DateTime?           @map("external_logo_updated_at")
  externalUrl                 String?             @map("external_url") @db.VarChar(512)
  metadataStorageSize         BigInt?             @default(0) @map("metadata_storage_size")
  orderArtistName             String?             @map("order_artist_name") @db.VarChar(255)
  size                        BigInt              @default(0)
  createdAt                   DateTime            @default(now()) @map("created_at")
  updatedAt                   DateTime            @updatedAt @map("updated_at")
  albumsAsAlbumArtist         Album[]             @relation("AlbumArtist")
  albums                      Album[]             @relation("ArtistAlbums")
  banners                     ArtistBanner[]
  genres                      ArtistGenre[]
  customImages                CustomArtistImage[]
  trackArtists                TrackArtist[]
  tracksAsAlbumArtist         Track[]             @relation("AlbumArtistTracks")
  tracks                      Track[]             @relation("ArtistTracks")

  @@index([name], map: "idx_artists_name")
  @@index([albumCount(sort: Desc)], map: "idx_artists_album_count")
  @@index([mbzArtistId], map: "idx_artists_mbid")
  @@map("artists")
}

model ArtistBanner {
  id        String   @id @default(uuid())
  artistId  String   @map("artist_id") @db.VarChar(36)
  imageUrl  String   @map("image_url") @db.VarChar(512)
  provider  String   @db.VarChar(50)
  order     Int      @default(0)
  createdAt DateTime @default(now()) @map("created_at")
  artist    Artist   @relation(fields: [artistId], references: [id], onDelete: Cascade)

  @@index([artistId])
  @@index([artistId, order])
  @@map("artist_banners")
}

model CustomArtistImage {
  id         String   @id @default(uuid())
  artistId   String   @map("artist_id") @db.VarChar(36)
  imageType  String   @map("image_type") @db.VarChar(20)
  filePath   String   @map("file_path") @db.VarChar(512)
  fileName   String   @map("file_name") @db.VarChar(255)
  fileSize   BigInt   @default(0) @map("file_size")
  mimeType   String   @map("mime_type") @db.VarChar(50)
  isActive   Boolean  @default(false) @map("is_active")
  uploadedBy String?  @map("uploaded_by") @db.VarChar(36)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  artist     Artist   @relation(fields: [artistId], references: [id], onDelete: Cascade)

  @@index([artistId])
  @@index([artistId, imageType])
  @@index([isActive])
  @@map("custom_artist_images")
}

model CustomAlbumCover {
  id         String   @id @default(uuid())
  albumId    String   @map("album_id") @db.VarChar(36)
  filePath   String   @map("file_path") @db.VarChar(512)
  fileName   String   @map("file_name") @db.VarChar(255)
  fileSize   BigInt   @default(0) @map("file_size")
  mimeType   String   @map("mime_type") @db.VarChar(50)
  isActive   Boolean  @default(false) @map("is_active")
  uploadedBy String?  @map("uploaded_by") @db.VarChar(36)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  album      Album    @relation(fields: [albumId], references: [id], onDelete: Cascade)

  @@index([albumId])
  @@index([isActive])
  @@map("custom_album_covers")
}

model Genre {
  id         String        @id @default(uuid())
  name       String        @unique @db.VarChar(100)
  albumCount Int           @default(0) @map("album_count")
  songCount  Int           @default(0) @map("song_count")
  albums     AlbumGenre[]
  artists    ArtistGenre[]
  tracks     TrackGenre[]

  @@map("genres")
}

model Album {
  id                    String             @id @default(uuid())
  name                  String             @db.VarChar(255)
  albumArtistId         String?            @map("album_artist_id") @db.VarChar(36)
  artistId              String?            @map("artist_id") @db.VarChar(36)
  coverArtPath          String?            @map("cover_art_path") @db.VarChar(512)
  externalCoverPath     String?            @map("external_cover_path") @db.VarChar(512)
  externalCoverSource   String?            @map("external_cover_source") @db.VarChar(50)
  year                  Int?
  releaseDate           DateTime?          @map("release_date") @db.Date
  originalDate          DateTime?          @map("original_date") @db.Date
  compilation           Boolean            @default(false)
  songCount             Int                @default(0) @map("song_count")
  duration              Int                @default(0)
  size                  BigInt             @default(0)
  mbzAlbumId            String?            @map("mbz_album_id") @db.VarChar(36)
  mbzAlbumArtistId      String?            @map("mbz_album_artist_id") @db.VarChar(36)
  mbzAlbumType          String?            @map("mbz_album_type") @db.VarChar(100)
  mbidSearchedAt        DateTime?          @map("mbid_searched_at")
  catalogNum            String?            @map("catalog_num") @db.VarChar(255)
  comment               String?            @db.VarChar(255)
  orderAlbumName        String?            @map("order_album_name") @db.VarChar(255)
  orderAlbumArtistName  String?            @map("order_album_artist_name") @db.VarChar(255)
  sortAlbumName         String?            @map("sort_album_name") @db.VarChar(255)
  sortArtistName        String?            @map("sort_artist_name") @db.VarChar(255)
  sortAlbumArtistName   String?            @map("sort_album_artist_name") @db.VarChar(255)
  description           String?
  externalUrl           String?            @map("external_url") @db.VarChar(512)
  externalInfoUpdatedAt DateTime?          @map("external_info_updated_at")
  createdAt             DateTime           @default(now()) @map("created_at")
  updatedAt             DateTime           @updatedAt @map("updated_at")
  genres                AlbumGenre[]
  albumArtist           Artist?            @relation("AlbumArtist", fields: [albumArtistId], references: [id])
  artist                Artist?            @relation("ArtistAlbums", fields: [artistId], references: [id])
  customCovers          CustomAlbumCover[]
  tracks                Track[]

  @@index([artistId], map: "idx_albums_artist")
  @@index([albumArtistId], map: "idx_albums_album_artist")
  @@index([year(sort: Desc)], map: "idx_albums_year")
  @@index([name], map: "idx_albums_name")
  @@index([mbzAlbumId], map: "idx_albums_mbid")
  @@index([mbzAlbumArtistId], map: "idx_albums_artist_mbid")
  @@map("albums")
}

model Track {
  id                   String           @id @default(uuid())
  title                String           @db.VarChar(255)
  albumId              String?          @map("album_id") @db.VarChar(36)
  albumArtistId        String?          @map("album_artist_id") @db.VarChar(36)
  artistId             String?          @map("artist_id") @db.VarChar(36)
  hasCoverArt          Boolean          @default(false) @map("has_cover_art")
  trackNumber          Int?             @map("track_number")
  discNumber           Int              @default(1) @map("disc_number")
  discSubtitle         String?          @map("disc_subtitle") @db.VarChar(255)
  year                 Int?
  date                 DateTime?        @db.Date
  originalDate         DateTime?        @map("original_date") @db.Date
  releaseDate          DateTime?        @map("release_date") @db.Date
  size                 BigInt?
  suffix               String?          @db.VarChar(10)
  duration             Int?
  bitRate              Int?             @map("bit_rate")
  channels             Int?
  fullText             String?          @map("full_text")
  albumName            String?          @map("album_name") @db.VarChar(255)
  artistName           String?          @map("artist_name") @db.VarChar(255)
  albumArtistName      String?          @map("album_artist_name") @db.VarChar(255)
  compilation          Boolean          @default(false)
  comment              String?          @db.VarChar(512)
  lyrics               String?
  sortTitle            String?          @map("sort_title") @db.VarChar(255)
  sortAlbumName        String?          @map("sort_album_name") @db.VarChar(255)
  sortArtistName       String?          @map("sort_artist_name") @db.VarChar(255)
  sortAlbumArtistName  String?          @map("sort_album_artist_name") @db.VarChar(255)
  orderTitle           String?          @map("order_title") @db.VarChar(255)
  orderAlbumName       String?          @map("order_album_name") @db.VarChar(255)
  orderArtistName      String?          @map("order_artist_name") @db.VarChar(255)
  orderAlbumArtistName String?          @map("order_album_artist_name") @db.VarChar(255)
  mbzTrackId           String?          @map("mbz_track_id") @db.VarChar(36)
  mbzAlbumId           String?          @map("mbz_album_id") @db.VarChar(36)
  mbzArtistId          String?          @map("mbz_artist_id") @db.VarChar(36)
  mbzAlbumArtistId     String?          @map("mbz_album_artist_id") @db.VarChar(36)
  mbzReleaseTrackId    String?          @map("mbz_release_track_id") @db.VarChar(36)
  mbidSearchedAt       DateTime?        @map("mbid_searched_at")
  catalogNum           String?          @map("catalog_num") @db.VarChar(255)
  path                 String           @unique @db.VarChar(512)
  bpm                  Int?
  rgAlbumGain          Float?           @map("rg_album_gain")
  rgAlbumPeak          Float?           @map("rg_album_peak")
  rgTrackGain          Float?           @map("rg_track_gain")
  rgTrackPeak          Float?           @map("rg_track_peak")
  createdAt            DateTime         @default(now()) @map("created_at")
  updatedAt            DateTime         @updatedAt @map("updated_at")
  playHistory          PlayHistory[]
  playQueues           PlayQueue[]
  playQueueTracks      PlayQueueTrack[]
  playlistTracks       PlaylistTrack[]
  trackArtists         TrackArtist[]
  genres               TrackGenre[]
  albumArtist          Artist?          @relation("AlbumArtistTracks", fields: [albumArtistId], references: [id])
  album                Album?           @relation(fields: [albumId], references: [id], onDelete: Cascade)
  artist               Artist?          @relation("ArtistTracks", fields: [artistId], references: [id])

  @@index([albumId], map: "idx_tracks_album")
  @@index([artistId], map: "idx_tracks_artist")
  @@index([title], map: "idx_tracks_title")
  @@index([path], map: "idx_tracks_path")
  @@index([albumId, trackNumber], map: "idx_tracks_album_track")
  @@index([mbzTrackId], map: "idx_tracks_mbid")
  @@index([mbzArtistId], map: "idx_tracks_artist_mbid")
  @@index([mbzAlbumId], map: "idx_tracks_album_mbid")
  @@map("tracks")
}

model TrackArtist {
  trackId    String @map("track_id") @db.VarChar(36)
  artistId   String @map("artist_id") @db.VarChar(36)
  artistName String @map("artist_name") @db.VarChar(255)
  artist     Artist @relation(fields: [artistId], references: [id], onDelete: Cascade)
  track      Track  @relation(fields: [trackId], references: [id], onDelete: Cascade)

  @@id([trackId, artistId])
  @@map("track_artists")
}

model ArtistGenre {
  artistId String @map("artist_id") @db.VarChar(36)
  genreId  String @map("genre_id") @db.VarChar(36)
  artist   Artist @relation(fields: [artistId], references: [id], onDelete: Cascade)
  genre    Genre  @relation(fields: [genreId], references: [id], onDelete: Cascade)

  @@id([artistId, genreId])
  @@map("artist_genres")
}

model AlbumGenre {
  albumId String @map("album_id") @db.VarChar(36)
  genreId String @map("genre_id") @db.VarChar(36)
  album   Album  @relation(fields: [albumId], references: [id], onDelete: Cascade)
  genre   Genre  @relation(fields: [genreId], references: [id], onDelete: Cascade)

  @@id([albumId, genreId])
  @@map("album_genres")
}

model TrackGenre {
  trackId String @map("track_id") @db.VarChar(36)
  genreId String @map("genre_id") @db.VarChar(36)
  genre   Genre  @relation(fields: [genreId], references: [id], onDelete: Cascade)
  track   Track  @relation(fields: [trackId], references: [id], onDelete: Cascade)

  @@id([trackId, genreId])
  @@map("track_genres")
}

model Playlist {
  id            String          @id @default(uuid())
  name          String          @db.VarChar(255)
  description   String?
  coverImageUrl String?         @map("cover_image_url") @db.VarChar(512)
  duration      Int             @default(0)
  size          BigInt          @default(0)
  ownerId       String          @map("owner_id") @db.VarChar(36)
  public        Boolean         @default(false)
  songCount     Int             @default(0) @map("song_count")
  path          String?         @db.VarChar(512)
  sync          Boolean         @default(false)
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")
  tracks        PlaylistTrack[]
  owner         User            @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([ownerId], map: "idx_playlists_owner")
  @@map("playlists")
}

model PlaylistTrack {
  id         String   @id @default(uuid())
  playlistId String   @map("playlist_id") @db.VarChar(36)
  trackId    String   @map("track_id") @db.VarChar(36)
  trackOrder Int      @map("track_order")
  createdAt  DateTime @default(now()) @map("created_at")
  playlist   Playlist @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  track      Track    @relation(fields: [trackId], references: [id], onDelete: Cascade)

  @@unique([playlistId, trackOrder])
  @@index([playlistId, trackOrder], map: "idx_playlist_tracks_playlist")
  @@map("playlist_tracks")
}

model UserStarred {
  userId      String   @map("user_id") @db.VarChar(36)
  starredId   String   @map("starred_id") @db.VarChar(36)
  starredType String   @map("starred_type") @db.VarChar(50)
  sentiment   String   @db.VarChar(20)
  starredAt   DateTime @default(now()) @map("starred_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, starredId, starredType])
  @@index([userId, starredAt(sort: Desc)], map: "idx_user_starred_user")
  @@index([starredId, starredType], map: "idx_user_starred_item")
  @@index([userId, sentiment], map: "idx_user_starred_sentiment")
  @@map("user_starred")
}

model UserRating {
  userId    String   @map("user_id") @db.VarChar(36)
  itemId    String   @map("item_id") @db.VarChar(36)
  itemType  String   @map("item_type") @db.VarChar(50)
  rating    Int
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, itemId, itemType])
  @@index([userId], map: "idx_user_ratings_user")
  @@index([itemId, itemType], map: "idx_ratings_item")
  @@map("user_ratings")
}

model PlayHistory {
  id             String   @id @default(uuid())
  userId         String   @map("user_id") @db.VarChar(36)
  trackId        String   @map("track_id") @db.VarChar(36)
  playedAt       DateTime @map("played_at")
  client         String?  @db.VarChar(255)
  playContext    String   @default("direct") @map("play_context") @db.VarChar(50)
  completionRate Float?   @map("completion_rate")
  skipped        Boolean  @default(false)
  sourceId       String?  @map("source_id") @db.VarChar(36)
  sourceType     String?  @map("source_type") @db.VarChar(50)
  createdAt      DateTime @default(now()) @map("created_at")
  track          Track    @relation(fields: [trackId], references: [id], onDelete: Cascade)
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, playedAt(sort: Desc)], map: "idx_play_history_user_date")
  @@index([trackId], map: "idx_play_history_track")
  @@index([playedAt(sort: Desc)], map: "idx_play_history_played_at")
  @@index([userId, playContext], map: "idx_play_history_context")
  @@index([sourceId, sourceType], map: "idx_play_history_source")
  @@map("play_history")
}

model UserPlayStats {
  userId            String    @map("user_id") @db.VarChar(36)
  itemId            String    @map("item_id") @db.VarChar(36)
  itemType          String    @map("item_type") @db.VarChar(50)
  playCount         BigInt    @default(0) @map("play_count")
  weightedPlayCount Float     @default(0) @map("weighted_play_count")
  lastPlayedAt      DateTime? @map("last_played_at")
  avgCompletionRate Float?    @map("avg_completion_rate")
  skipCount         BigInt    @default(0) @map("skip_count")
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, itemId, itemType])
  @@index([userId, playCount(sort: Desc)], map: "idx_user_play_stats_user")
  @@index([userId, weightedPlayCount(sort: Desc)], map: "idx_user_play_stats_weighted")
  @@index([itemId, itemType], map: "idx_user_play_stats_item")
  @@map("user_play_stats")
}

model PlayQueue {
  id             String           @id @default(uuid())
  userId         String           @unique @map("user_id") @db.VarChar(36)
  currentTrackId String?          @map("current_track_id") @db.VarChar(36)
  position       BigInt           @default(0)
  changedBy      String?          @map("changed_by") @db.VarChar(255)
  createdAt      DateTime         @default(now()) @map("created_at")
  updatedAt      DateTime         @updatedAt @map("updated_at")
  currentTrack   Track?           @relation(fields: [currentTrackId], references: [id])
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  tracks         PlayQueueTrack[]

  @@map("play_queue")
}

model PlayQueueTrack {
  id         String    @id @default(uuid())
  queueId    String    @map("queue_id") @db.VarChar(36)
  trackId    String    @map("track_id") @db.VarChar(36)
  queueOrder Int       @map("queue_order")
  createdAt  DateTime  @default(now()) @map("created_at")
  queue      PlayQueue @relation(fields: [queueId], references: [id], onDelete: Cascade)
  track      Track     @relation(fields: [trackId], references: [id], onDelete: Cascade)

  @@unique([queueId, queueOrder])
  @@index([queueId, queueOrder], map: "idx_play_queue_tracks_queue")
  @@map("play_queue_tracks")
}

model Bookmark {
  id        String   @id @default(uuid())
  userId    String   @map("user_id") @db.VarChar(36)
  itemId    String   @map("item_id") @db.VarChar(36)
  itemType  String   @map("item_type") @db.VarChar(50)
  position  BigInt
  comment   String?  @db.VarChar(512)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, itemId, itemType])
  @@map("bookmarks")
}

model Share {
  id            String    @id @default(uuid())
  userId        String    @map("user_id") @db.VarChar(36)
  description   String?   @db.VarChar(512)
  expiresAt     DateTime? @map("expires_at")
  lastVisitedAt DateTime? @map("last_visited_at")
  resourceIds   String    @map("resource_ids")
  resourceType  String    @map("resource_type") @db.VarChar(50)
  visitCount    Int       @default(0) @map("visit_count")
  downloadable  Boolean   @default(true)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("shares")
}

model RadioStation {
  id          String   @id @default(uuid())
  userId      String   @map("user_id") @db.VarChar(36)
  stationUuid String?  @map("station_uuid") @db.VarChar(255)
  name        String   @db.VarChar(255)
  url         String   @db.VarChar(512)
  urlResolved String?  @map("url_resolved") @db.VarChar(512)
  homepage    String?  @db.VarChar(512)
  favicon     String?  @db.VarChar(512)
  country     String?  @db.VarChar(100)
  countryCode String?  @map("country_code") @db.VarChar(10)
  state       String?  @db.VarChar(100)
  language    String?  @db.VarChar(100)
  tags        String?  @db.VarChar(512)
  codec       String?  @db.VarChar(50)
  bitrate     Int?
  votes       Int?
  clickCount  Int?     @map("click_count")
  lastCheckOk Boolean? @map("last_check_ok")
  source      String   @db.VarChar(20)
  isFavorite  Boolean  @default(true) @map("is_favorite")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([stationUuid])
  @@index([userId, isFavorite])
  @@map("radio_stations")
}

model Transcoding {
  id             String   @id @default(uuid())
  name           String   @db.VarChar(255)
  targetFormat   String   @map("target_format") @db.VarChar(10)
  defaultBitRate Int?     @map("default_bit_rate")
  command        String
  createdAt      DateTime @default(now()) @map("created_at")
  players        Player[]

  @@map("transcoding")
}

model Player {
  id              String       @id @default(uuid())
  name            String       @db.VarChar(255)
  type            String?      @db.VarChar(50)
  userName        String?      @map("user_name") @db.VarChar(255)
  userId          String?      @map("user_id") @db.VarChar(36)
  client          String?      @db.VarChar(255)
  ipAddress       String?      @map("ip_address") @db.VarChar(45)
  lastSeen        DateTime?    @map("last_seen")
  maxBitRate      Int?         @map("max_bit_rate")
  transcodingId   String?      @map("transcoding_id") @db.VarChar(36)
  scrobbleEnabled Boolean      @default(true) @map("scrobble_enabled")
  transcoding     Transcoding? @relation(fields: [transcodingId], references: [id])
  user            User?        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("players")
}

model MetadataCache {
  entityId   String    @map("entity_id") @db.VarChar(36)
  entityType String    @map("entity_type") @db.VarChar(50)
  provider   String    @db.VarChar(50)
  data       String
  fetchedAt  DateTime  @default(now()) @map("fetched_at")
  expiresAt  DateTime? @map("expires_at")

  @@id([entityId, entityType, provider])
  @@index([expiresAt], map: "idx_metadata_cache_expires")
  @@map("metadata_cache")
}

model MbidSearchCache {
  id           String   @id @default(uuid())
  queryText    String   @map("query_text")
  queryType    String   @map("query_type") @db.VarChar(20)
  queryParams  Json     @default("{}") @map("query_params")
  results      Json     @map("results")
  resultCount  Int      @default(0) @map("result_count")
  createdAt    DateTime @default(now()) @map("created_at")
  expiresAt    DateTime @map("expires_at")
  hitCount     Int      @default(0) @map("hit_count")
  lastHitAt    DateTime? @map("last_hit_at")

  @@unique([queryText, queryType, queryParams], map: "unique_mbid_search")
  @@index([queryText, queryType], map: "idx_mbid_search_lookup")
  @@index([expiresAt], map: "idx_mbid_search_expires")
  @@map("mbid_search_cache")
}

model LibraryScan {
  id            String    @id @default(uuid())
  status        String    @db.VarChar(50)
  startedAt     DateTime  @default(now()) @map("started_at")
  finishedAt    DateTime? @map("finished_at")
  tracksAdded   Int       @default(0) @map("tracks_added")
  tracksUpdated Int       @default(0) @map("tracks_updated")
  tracksDeleted Int       @default(0) @map("tracks_deleted")
  errorMessage  String?   @map("error_message")

  @@map("library_scans")
}

model MetadataConflict {
  id             String    @id @default(uuid())
  entityId       String    @map("entity_id") @db.VarChar(36)
  entityType     String    @map("entity_type") @db.VarChar(20)
  field          String    @db.VarChar(50)
  currentValue   String?   @map("current_value")
  suggestedValue String    @map("suggested_value")
  source         String    @db.VarChar(50)
  status         String    @default("pending") @db.VarChar(20)
  priority       Int       @default(1)
  metadata       Json?
  createdAt      DateTime  @default(now()) @map("created_at")
  resolvedAt     DateTime? @map("resolved_at")
  resolvedBy     String?   @map("resolved_by") @db.VarChar(36)

  @@index([entityId, entityType])
  @@index([status])
  @@index([createdAt])
  @@map("metadata_conflicts")
}

model EnrichmentLog {
  id             String   @id @default(uuid())
  entityId       String   @map("entity_id") @db.VarChar(36)
  entityType     String   @map("entity_type") @db.VarChar(20)
  entityName     String   @map("entity_name") @db.VarChar(255)
  provider       String   @db.VarChar(50)
  metadataType   String   @map("metadata_type") @db.VarChar(50)
  status         String   @db.VarChar(20)
  fieldsUpdated  String[] @map("fields_updated")
  errorMessage   String?  @map("error_message")
  previewUrl     String?  @map("preview_url") @db.VarChar(512)
  userId         String?  @map("user_id") @db.VarChar(36)
  processingTime Int?     @map("processing_time")
  createdAt      DateTime @default(now()) @map("created_at")

  @@index([entityId, entityType])
  @@index([provider])
  @@index([status])
  @@index([createdAt])
  @@index([userId])
  @@map("enrichment_logs")
}

model Setting {
  key         String   @id @db.VarChar(100)
  value       String
  category    String   @db.VarChar(50)
  type        String   @default("string") @db.VarChar(20)
  description String?
  isPublic    Boolean  @default(false) @map("is_public")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([category])
  @@map("settings")
}

model SystemLog {
  id         String   @id @default(uuid())
  level      String   @db.VarChar(20)
  category   String   @db.VarChar(50)
  message    String
  details    String?
  userId     String?  @map("user_id") @db.VarChar(36)
  entityId   String?  @map("entity_id") @db.VarChar(36)
  entityType String?  @map("entity_type") @db.VarChar(20)
  stackTrace String?  @map("stack_trace")
  requestId  String?  @map("request_id") @db.VarChar(36)
  ipAddress  String?  @map("ip_address") @db.VarChar(45)
  userAgent  String?  @map("user_agent") @db.VarChar(512)
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([level, createdAt])
  @@index([category, createdAt])
  @@index([userId])
  @@index([requestId])
  @@index([createdAt])
  @@map("system_logs")
}
