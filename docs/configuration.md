# Configuration

## Environment Variables

### Production (.env)

Create a `.env` file next to `docker-compose.yml`:

```bash
# Echo port (default: 4567)
ECHO_PORT=4567

# Database
POSTGRES_USER=echo
POSTGRES_PASSWORD=your_secure_password
POSTGRES_DB=echo

# Redis
REDIS_PASSWORD=another_secure_password

# CORS (optional, for custom domains)
CORS_ORIGINS=https://music.yourdomain.com
```

### Full Reference

| Variable | Default | Description |
|----------|---------|-------------|
| `ECHO_PORT` | `4567` | External port |
| `POSTGRES_USER` | `echo` | PostgreSQL user |
| `POSTGRES_PASSWORD` | auto-generated | PostgreSQL password |
| `POSTGRES_DB` | `echo` | Database name |
| `REDIS_PASSWORD` | auto-generated | Redis password |
| `DATA_PATH` | `/app/data` | Internal data path |
| `CORS_ORIGINS` | auto-detected | Allowed CORS origins |

### Development (api/.env)

Auto-generated by `pnpm quickstart`:

```bash
NODE_ENV=development
PORT=3000
DATABASE_URL=postgresql://music_user:music_password@localhost:5432/music_db
JWT_SECRET=<auto-generated>
JWT_REFRESH_SECRET=<auto-generated>
REDIS_HOST=localhost
REDIS_PASSWORD=dev_redis_password
```

## Volumes

| Volume | Description | Backup |
|--------|-------------|--------|
| `./data:/app/data` | Covers, metadata, config | Yes |
| `postgres_data` | Database | Yes |
| `redis_data` | Cache | No (regenerated) |
| `/mnt:/mnt:ro` | Music (read-only) | No |

## Ports

| Port | Service | Environment |
|------|---------|-------------|
| 4567 | Echo | Production |
| 5173 | Frontend | Development |
| 3000 | Backend | Development |
| 5432 | PostgreSQL | Development (exposed) |
| 6379 | Redis | Development (exposed) |

> In production, PostgreSQL and Redis are not exposed (only accessible within the Docker network).

## Music Paths

Add read-only volumes:

```yaml
services:
  echo:
    volumes:
      - ./data:/app/data
      - /mnt/nas/music:/music:ro
      - /home/user/Music:/local:ro
```

Paths will appear in the admin panel for library configuration.

## Security

- **JWT secrets** — Auto-generated in `/app/data/secrets.env` on first run
- **Passwords** — Use unique values in `.env` for production
- **Music** — Mounted as read-only (`:ro`)
- **Docker network** — PostgreSQL/Redis isolated, not exposed
